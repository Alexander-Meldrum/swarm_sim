syntax = "proto3";

package swarm_proto;

service swarm_proto_service {
  rpc Step (StepRequest) returns (StepResponse);
  rpc Reset (ResetRequest) returns (ResetResponse);
}

/* --- Per-drone data --- */
message DroneAction {
  // 3 actions
  float ax = 1;
  float ay = 2;
  float az = 3;
}

message DroneObservation {
  // 3 observations
  float ox = 1;
  float oy = 2;
  float oz = 3;

  // Collision information, desired: hit target foe, undesired: hit friend or ground.
  uint32 collisions_desired = 4;
  uint32 collisions_undesired = 5;

  // Alive flag
  bool alive = 6;
}

/* --- Step API --- */
message StepRequest {
  // team_id, 0 for external, 1 for rule-based or second external controller
  uint32 team_id = 1;
  uint64 step = 2;
  // One action per drone
  repeated DroneAction actions = 3;
}

message StepResponse {
  uint64 step = 1;
  // One observation per drone (same ordering)
  repeated DroneObservation observations = 2;
  // Global RL signals
  float global_reward = 3;
  bool done = 4;
}

/* --- Reset API --- */
enum TeamControl {
  EXTERNAL = 0;
  RULE_BASED = 1;
}

message ResetRequest {
  uint64 seed = 1;
  uint32 num_drones_team_0 = 2;  // Number of drones in default team
  uint32 num_drones_team_1 = 3;  // Number of rule-based / opponent drones
  TeamControl team_0_control = 4;
  TeamControl team_1_control = 5;
  uint64 max_steps = 6;
  bool randomize_init_pos = 8;
}

message ResetResponse {
  uint64 step = 1;
  uint32 num_drones_team_0 = 2;
  uint32 num_drones_team_1 = 3;
  uint64 max_steps = 4;
  float dt = 5;
  repeated DroneObservation observations = 6;
}